{"hash":"e6b83a65741144aa2d8e63f4281f678b5f8e1d5e","data":{"markdownPage":{"id":"4afab9a63bedcf866507c2f2d3820c19","title":"Настройка ssh","description":"Мануал по полной настройке ssh в Arch подобных дистрибутивах Linux.","date":null,"date_up":"13.08.2020","path":"/wiki/config/ssh/","timeToRead":1,"content":"<h1 id=\"установка-и-настройка-ssh\"><a href=\"#%D1%83%D1%81%D1%82%D0%B0%D0%BD%D0%BE%D0%B2%D0%BA%D0%B0-%D0%B8-%D0%BD%D0%B0%D1%81%D1%82%D1%80%D0%BE%D0%B9%D0%BA%D0%B0-ssh\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>Установка и настройка ssh</h1>\n<p><img class=\"g-image g-image--lazy g-image--loading\" src=\"data:image/svg+xml,%3csvg fill='none' viewBox='0 0 608 300' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink'%3e%3cdefs%3e%3cfilter id='__svg-blur-bbc5ffc32e902351799bff579129fe32'%3e%3cfeGaussianBlur in='SourceGraphic' stdDeviation='40'/%3e%3c/filter%3e%3c/defs%3e%3cimage x='0' y='0' filter='url(%23__svg-blur-bbc5ffc32e902351799bff579129fe32)' width='608' height='300' xlink:href='data:image/png%3bbase64%2ciVBORw0KGgoAAAANSUhEUgAAAEAAAAAgCAIAAAAt/%2bnTAAAACXBIWXMAAA7EAAAOxAGVKw4bAAADcklEQVRYw%2b1WW27jRhD0NTQ9nPeLz%2bFbsmTtfngXyWdOkiMkV8iR0yNKljfJLmhjEfiDQGHQGhpEVXV10w%2bZcCtgL0gFFeblknLz%2btG3xcvP77yN2/%2b45zesYpXwsIa94JVnk2EjwrHDUiCkbI2dpG4zEZSdpe4o11w10kzKTsIN2VXh5T1XcoaqAsqZupgxc6fLLc0jxAniSH29XsPDCu%2bDz45MBM5zyVqX7ZdamdnnX4TuLnRnaQY8M%2bGtOyXeqiTVOZMhU/lFhqO6QOANqY9QTKhhucx0ntiXHdQ9aSaoOmj6pO1nCWCitGzgvDBsX8MvkteCVV4%2b%2bfBZ6FaaUaDlFxlMeORH/USRffMMNoLrIcxQDFDMEEYaOtKcSDEiY9RA4hFCC0ULZUvGR%2bqrVFf997P3rghRYX12wsCg8Y4ec36Wps1k7vJnTIuyB%2bPPQsVkP9eZLIgfwI2L/eAGKsNu/EpdQ20D%2bUjiU6YK6lsSD0ltEakO1GCoIpQ99RH7sN7%2blR0IaC3ab1ivwoHJoN0TWq7MSFNSPWVa549MhYuvJ2qaXf2MJ/gZGaPxpNpTDBLS1SWpH6EcAAOTooJNGJEx1AMqwT5A12YK58H9RAHBsEFnnaGDkBiYPoVet8L0XNU4qdphlAMPU%2boV%2bm1bqioSHlPhIoSBmhpCRwMGw0PRp1aYcnf4hK5TV6GSdGIfypiKJr6J/Y8FeCq0YbNjs9A106XxGPrIVYXRN%2b6k3VGYTuUHKM%2bAA2oiKY5pw4Q95DNpjkialHsSP6ESlIGx2c2fSZuWzO5whnamtqR5A90BYk%2bmDuYxs/mbduiaDnjOK6UiUmeyQNexSDJSXeFTXDJUV2nspEf2yXhdY1TSeklLpkywddLgmrRtkHRo0iMsXJWArTB5gnsz%2b5VDbHC7L98sPBfcv1Ovvzup1mlpvtruy%2b5Pc7mMJv58Xbx8Crh7B/skgEuHYNIBV1x5roK4nFjfCrzJb0X4R3GDv97o%2b%2bW//uYG/YPL23u%2bKa58uPTsAr5A%2bSQA%2b85UEfz0%2b69/aF0DN%2b%2bw4f%2bB0EGZXOoFuBsvHQDfcxPr8vznb39ZEz%2bsADRemty4UrtC28L6Cm%2bSAHaNtf7I3t8HkuNMLpN5H2K/bJuPz/7d/41uAjYBm4BNwCZgE7AJ2ARsAjYBm4BNwIfE32IULnmPeo6bAAAAAElFTkSuQmCC' /%3e%3c/svg%3e\" width=\"608\" alt=\"Tнастройка ssh\" data-srcset=\"/assets/static/ssh.e8fe0bf.9bd9bf31c1497094f39ed4eae60123ff.png 608w\" data-sizes=\"(max-width: 608px) 100vw, 608px\" data-src=\"/assets/static/ssh.e8fe0bf.9bd9bf31c1497094f39ed4eae60123ff.png\"><noscript><img class=\"g-image g-image--lazy g-image--loaded\" src=\"/assets/static/ssh.e8fe0bf.9bd9bf31c1497094f39ed4eae60123ff.png\" width=\"608\" alt=\"Tнастройка ssh\"></noscript></p>\n<h2 id=\"установка-клиент---сервер\"><a href=\"#%D1%83%D1%81%D1%82%D0%B0%D0%BD%D0%BE%D0%B2%D0%BA%D0%B0-%D0%BA%D0%BB%D0%B8%D0%B5%D0%BD%D1%82---%D1%81%D0%B5%D1%80%D0%B2%D0%B5%D1%80\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>Установка клиент - сервер</h2>\n<pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">sudo</span> pacman -S openssh</code></pre>\n<p>На сервере запустить и включить сервис в автостарт.</p>\n<pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">sudo</span> systemctl start sshd\n<span class=\"token function\">sudo</span> systemctl <span class=\"token builtin class-name\">enable</span> sshd</code></pre>\n<h2 id=\"настройка-на-клиенте\"><a href=\"#%D0%BD%D0%B0%D1%81%D1%82%D1%80%D0%BE%D0%B9%D0%BA%D0%B0-%D0%BD%D0%B0-%D0%BA%D0%BB%D0%B8%D0%B5%D0%BD%D1%82%D0%B5\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>Настройка на клиенте</h2>\n<h3 id=\"генерация-ключей\"><a href=\"#%D0%B3%D0%B5%D0%BD%D0%B5%D1%80%D0%B0%D1%86%D0%B8%D1%8F-%D0%BA%D0%BB%D1%8E%D1%87%D0%B5%D0%B9\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>Генерация ключей</h3>\n<pre class=\"language-bash\"><code class=\"language-bash\">ssh-keygen -t rsa -b <span class=\"token number\">4096</span> -C <span class=\"token string\">\"ctlos@protonmail.com\"</span></code></pre>\n<p>Ключи упадут в <code>~/.ssh</code>.</p>\n<h3 id=\"отправка-ключа-на-сервер\"><a href=\"#%D0%BE%D1%82%D0%BF%D1%80%D0%B0%D0%B2%D0%BA%D0%B0-%D0%BA%D0%BB%D1%8E%D1%87%D0%B0-%D0%BD%D0%B0-%D1%81%D0%B5%D1%80%D0%B2%D0%B5%D1%80\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>Отправка ключа на сервер</h3>\n<pre class=\"language-bash\"><code class=\"language-bash\">ssh-copy-id username@remote_host</code></pre>\n<p>Или так. Копируем ключ на сервер.</p>\n<pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">cat</span> .ssh/id_rsa.pub <span class=\"token operator\">|</span> <span class=\"token function\">ssh</span> dj2@192.168.1.35 <span class=\"token string\">'mkdir -p ~/.ssh &amp;&amp; cat >> .ssh/authorized_keys'</span></code></pre>\n<h3 id=\"настройка-конфига-на-клиенте\"><a href=\"#%D0%BD%D0%B0%D1%81%D1%82%D1%80%D0%BE%D0%B9%D0%BA%D0%B0-%D0%BA%D0%BE%D0%BD%D1%84%D0%B8%D0%B3%D0%B0-%D0%BD%D0%B0-%D0%BA%D0%BB%D0%B8%D0%B5%D0%BD%D1%82%D0%B5\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>Настройка конфига на клиенте</h3>\n<pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">nano</span> ~/.ssh/config</code></pre>\n<p>Подгоняем конфиг под конкретный сервер. Комментарии не учитываются <code>#</code>. Хостов может быть сколько угодно, какждый - сервер.</p>\n<pre class=\"language-bash\"><code class=\"language-bash\">Host *\n    <span class=\"token comment\">#ForwardAgent yes</span>\n    <span class=\"token comment\">#ForwardX11 yes</span>\n    <span class=\"token comment\">#ForwardX11Trusted yes</span>\n\nHost dj\n    ForwardAgent <span class=\"token function\">yes</span>\n    ForwardX11 <span class=\"token function\">yes</span>\n    ForwardX11Trusted <span class=\"token function\">yes</span>\n    HostName <span class=\"token number\">198.157</span>.18.18\n    Port <span class=\"token number\">223</span>\n    User dj2</code></pre>\n<p>Блок с <code>Host *</code> задает глобальные настройки для всех серверов.</p>\n<p>Данный блок с <code>Host dj</code> конкретно под сервер.</p>\n<ul>\n<li>Host: может быть любой, для вашего удобства.</li>\n<li>Строки c <code>Forward</code>: включаем X11Forwarding.</li>\n<li>Дальше ip, port, user (понятно).</li>\n</ul>\n<h2 id=\"настройка-на-сервере\"><a href=\"#%D0%BD%D0%B0%D1%81%D1%82%D1%80%D0%BE%D0%B9%D0%BA%D0%B0-%D0%BD%D0%B0-%D1%81%D0%B5%D1%80%D0%B2%D0%B5%D1%80%D0%B5\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>Настройка на сервере</h2>\n<p>Файл конфигурации тут: <code>/etc/ssh/sshd_config</code>.</p>\n<p>Запрещаем авторизацию от <code>root</code>, можно не править, по умолчанию так.</p>\n<pre class=\"language-bash\"><code class=\"language-bash\">PermitRootLogin no</code></pre>\n<p>Если правим, то укажем кому можно.</p>\n<pre class=\"language-bash\"><code class=\"language-bash\">AllowUsers dj2 bob</code></pre>\n<p>Отключение авторизации по паролю.</p>\n<pre class=\"language-bash\"><code class=\"language-bash\">PasswordAuthentication no</code></pre>\n<p>Укажем в конфиге файл авторизации.</p>\n<pre class=\"language-bash\"><code class=\"language-bash\">AuthorizedKeysFile  .ssh/authorized_keys</code></pre>\n<p>Права как на клиенте так и на сервере.</p>\n<pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">chmod</span> <span class=\"token number\">700</span> ~/.ssh\n<span class=\"token function\">chmod</span> <span class=\"token number\">600</span> ~/.ssh/*\n<span class=\"token function\">chown</span> -R <span class=\"token environment constant\">$USER</span> ~/.ssh</code></pre>\n<p>Перезапустить сервис.</p>\n<pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">sudo</span> systemctl restart sshd</code></pre>\n<h3 id=\"x11forwarding-на-сервере\"><a href=\"#x11forwarding-%D0%BD%D0%B0-%D1%81%D0%B5%D1%80%D0%B2%D0%B5%D1%80%D0%B5\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>X11Forwarding на сервере</h3>\n<p>Снять комментарии и привести строки в вид, в файле <code>/etc/ssh/sshd_config</code>.</p>\n<pre class=\"language-bash\"><code class=\"language-bash\">X11Forwarding <span class=\"token function\">yes</span>\nX11DisplayOffset <span class=\"token number\">10</span>\nX11UseLocalhost no</code></pre>\n<p>Перезапустить сервис.</p>\n<pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">sudo</span> systemctl restart sshd</code></pre>\n<p>При запуске через sudo, если ошибка <code>cannot open display: xxx-xx:10.0</code> нужно скопировать файл авторизации в <code>/root</code>.</p>\n<pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">sudo</span> <span class=\"token function\">cp</span> ~user_name/.Xauthority ~root/.Xauthority</code></pre>\n","sidebar":"wiki","next":"","prev":"/wiki/config/autologin/","headings":[{"depth":1,"value":"Установка и настройка ssh","anchor":"#установка-и-настройка-ssh"},{"depth":2,"value":"Установка клиент - сервер","anchor":"#установка-клиент---сервер"},{"depth":2,"value":"Настройка на клиенте","anchor":"#настройка-на-клиенте"},{"depth":3,"value":"Генерация ключей","anchor":"#генерация-ключей"},{"depth":3,"value":"Отправка ключа на сервер","anchor":"#отправка-ключа-на-сервер"},{"depth":3,"value":"Настройка конфига на клиенте","anchor":"#настройка-конфига-на-клиенте"},{"depth":2,"value":"Настройка на сервере","anchor":"#настройка-на-сервере"},{"depth":3,"value":"X11Forwarding на сервере","anchor":"#x11forwarding-на-сервере"}]},"allMarkdownPage":{"edges":[{"node":{"path":"/wiki/changelog/bspwm-1-0/","title":"Bspwm 1.0B"}},{"node":{"path":"/wiki/other/screencast/","title":"Screencast"}},{"node":{"path":"/wiki/wm/bspwm/","title":"Killer-OS Bspwm"}},{"node":{"path":"/wiki/packages/other-pkg/","title":"Añadir. programas"}},{"node":{"path":"/wiki/packages/iwd/","title":"Iwd wifi"}},{"node":{"path":"/wiki/","title":"Killer-OS Linux Wiki"}},{"node":{"path":"/wiki/other/notes/","title":"Notas"}},{"node":{"path":"/wiki/other/grub-uefi/","title":"Grub UEFI"}},{"node":{"path":"/wiki/other/gnupg/","title":"Gnupg"}},{"node":{"path":"/wiki/other/git-start/","title":"Git Start"}},{"node":{"path":"/wiki/config/ssh/","title":"Настройка ssh"}},{"node":{"path":"/wiki/config/videocfg/","title":"Видео драйвера"}},{"node":{"path":"/wiki/config/trouble/","title":"Решение проблем"}},{"node":{"path":"/wiki/config/recomend/","title":"Рекомендации"}},{"node":{"path":"/wiki/config/autologin/","title":"Автологин"}},{"node":{"path":"/wiki/whois/","title":"Brevemente sobre Killer-OS Linux"}},{"node":{"path":"/wiki/changelog/","title":"Changelog"}},{"node":{"path":"/wiki/btrfs/btrfs-part2/","title":"Btrfs Continuar"}},{"node":{"path":"/wiki/btrfs/btrfs-part1/","title":"Instalación de btrfs"}},{"node":{"path":"/wiki/backup/timeshift-rsync/","title":"Timeshift, rsync"}},{"node":{"path":"/wiki/backup/squashfs/","title":"Squashfs"}},{"node":{"path":"/wiki/backup/netcat/","title":"Netcat, ssh, rsync"}}]}},"context":{}}