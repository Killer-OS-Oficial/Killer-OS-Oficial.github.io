{"hash":"6c477ae7968d6fcc655196c06675f20edeb9b19e","data":{"markdownPage":{"id":"6758607a6e5a3f87f5060612489a9e39","title":"Netcat, ssh, rsync","description":"","date":null,"date_up":"13.08.2020","path":"/wiki/backup/netcat/","timeToRead":2,"content":"<h2 id=\"trabajando-con-netcat-ssh-rsync\"><a href=\"#trabajando-con-netcat-ssh-rsync\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>Trabajando con Netcat, ssh, rsync</h2>\n<pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">sudo</span> pacman -S gnu-netcat <span class=\"token function\">pv</span></code></pre>\n<p>Ejemplos de transferencias.</p>\n<pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">cat</span> dump.iso <span class=\"token operator\">|</span> <span class=\"token function\">pv</span> -b <span class=\"token operator\">|</span> <span class=\"token function\">nc</span> -l <span class=\"token number\">3333</span>\n\n<span class=\"token function\">dd</span> <span class=\"token assign-left variable\">if</span><span class=\"token operator\">=</span>/dev/sdb5 <span class=\"token operator\">|</span> <span class=\"token function\">gzip</span> -9 <span class=\"token operator\">|</span> <span class=\"token function\">nc</span> -l <span class=\"token number\">3333</span>\n\n<span class=\"token function\">tar</span> -czf - /etc/ <span class=\"token operator\">|</span> <span class=\"token function\">pv</span> -b <span class=\"token operator\">|</span> <span class=\"token function\">nc</span> -l <span class=\"token number\">3333</span></code></pre>\n<p>Ejemplos de recepción.</p>\n<pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">nc</span> <span class=\"token number\">187.187</span>.55.18 <span class=\"token number\">3333</span> <span class=\"token operator\">|</span> <span class=\"token function\">pv</span> -b <span class=\"token operator\">></span> dump.iso\n\n<span class=\"token function\">nc</span> <span class=\"token number\">187.187</span>.55.18 <span class=\"token number\">3333</span> <span class=\"token operator\">|</span> <span class=\"token function\">pv</span> -b <span class=\"token operator\">></span> ddsdb5dump.img.gz\n\n<span class=\"token function\">nc</span> <span class=\"token number\">187.187</span>.55.18 <span class=\"token number\">3333</span> <span class=\"token operator\">|</span> <span class=\"token function\">pv</span> -b <span class=\"token operator\">></span> dump.tar.gz</code></pre>\n<h2 id=\"un-ejemplo-de-cómo-obtener-un-túnel-ssh\"><a href=\"#un-ejemplo-de-c%C3%B3mo-obtener-un-t%C3%BAnel-ssh\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>Un ejemplo de cómo obtener un túnel ssh</h2>\n<p>Esto es necesario si no hay acceso al puerto \"3333\". Toda la transmisión está encriptada porque ssh.</p>\n<p>Cree un puente (túnel) a ip <code>127.0.0.1</code> (localhost), al puerto<code>23333</code>. <code>-p 22</code> Este es el puerto ssh estándar y generalmente se cambia.</p>\n<pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">ssh</span> -p <span class=\"token number\">22</span> -f -L <span class=\"token number\">23333</span>:127.0.0.1:3333 name@187.187.55.18 <span class=\"token function\">sleep</span> <span class=\"token number\">10</span><span class=\"token punctuation\">;</span> <span class=\"token punctuation\">\\</span>\n<span class=\"token function\">nc</span> <span class=\"token number\">127.0</span>.0.1 <span class=\"token number\">23333</span> <span class=\"token operator\">|</span> <span class=\"token function\">pv</span> -b <span class=\"token operator\">></span> killer-os.iso\n\n<span class=\"token function\">ssh</span> -p <span class=\"token number\">22</span> -fN -L <span class=\"token number\">23333</span>:127.0.0.1:3333 name@187.187.55.18   <span class=\"token comment\"># reenvío de puertos</span></code></pre>\n<h2 id=\"ssh-scp\"><a href=\"#ssh-scp\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>SSH <strong>scp</strong></h2>\n<p>De lo local a lo remoto.</p>\n<pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">scp</span> -P <span class=\"token number\">2222</span> file.txt file2.txt name@187.187.55.18:/home/user/dir\n\n<span class=\"token function\">scp</span> -P <span class=\"token number\">2222</span> -r dir1 name@187.187.55.18:/home/user/dir2</code></pre>\n<p>De remoto a LAN.</p>\n<pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">scp</span> -P <span class=\"token number\">2222</span> name@187.187.55.18:file.txt /home/user/dir\n\n<span class=\"token function\">scp</span> -P <span class=\"token number\">2222</span> name@187.187.55.18:~/<span class=\"token punctuation\">\\</span><span class=\"token punctuation\">{</span>file1,file2,file3<span class=\"token punctuation\">\\</span><span class=\"token punctuation\">}</span> <span class=\"token builtin class-name\">.</span>\n\n<span class=\"token function\">scp</span> -P <span class=\"token number\">2222</span> -r name@187.187.55.18:/home/dir/ /home/user/dir/</code></pre>\n<p>De un servidor a otro.</p>\n<pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">scp</span> name@187.187.55.18:/dir/file.txt name@198.198.188.18:/name/dir/</code></pre>\n<h2 id=\"sincronización-rsync\"><a href=\"#sincronizaci%C3%B3n-rsync\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>Sincronización Rsync</h2>\n<p>Instalando  <strong>rsync</strong>.</p>\n<pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">sudo</span> pacman -S <span class=\"token function\">rsync</span></code></pre>\n<p>En el servidor, debe crear un directorio <code>/dump</code>, iniciar el servicio (demonio), configurar la configuración y abrir el puerto 873 (tcp).</p>\n<pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">sudo</span> systemctl start rsyncd.service</code></pre>\n<p>uid es el usuario en el servidor, gid es el grupo al que pertenece (usualmente usuarios). Cree <code>/dump</code> en el servidor y dele derechos.</p>\n<pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">sudo</span> <span class=\"token function\">mkdir</span> /dump\n<span class=\"token function\">sudo</span> <span class=\"token function\">chown</span> username:users /dump</code></pre>\n<p>Configuración: <code>/etc/rsyncd.conf</code>. Especifique la ip en <code>hosts deny</code> desde la que se está conectando.</p>\n<pre class=\"language-bash\"><code class=\"language-bash\">syslog <span class=\"token assign-left variable\">facility</span><span class=\"token operator\">=</span>daemon\npid <span class=\"token assign-left variable\">file</span><span class=\"token operator\">=</span>/var/run/rsyncd.pid\ntransfer logging <span class=\"token operator\">=</span> <span class=\"token function\">yes</span>\nlog <span class=\"token function\">file</span> <span class=\"token operator\">=</span> /var/log/rsyncd.log\nmax connections <span class=\"token operator\">=</span> <span class=\"token number\">10</span>\nexclude <span class=\"token operator\">=</span> lost+found/\ndont compress <span class=\"token operator\">=</span> *.gz *.tgz *.zip *.z *.rpm *.deb *.iso *.bz2 *.tbz\n\n<span class=\"token punctuation\">[</span>dump<span class=\"token punctuation\">]</span>\ncomment <span class=\"token operator\">=</span> <span class=\"token function\">rsync</span> <span class=\"token function\">open</span> <span class=\"token keyword\">for</span> dump\nuid <span class=\"token operator\">=</span> username\ngid <span class=\"token operator\">=</span> <span class=\"token function\">users</span>\n<span class=\"token comment\">#auth users = killer</span>\n<span class=\"token comment\">#secrets file = /etc/rsyncd.scrt</span>\npath <span class=\"token operator\">=</span> /dump/\nlist <span class=\"token operator\">=</span> <span class=\"token function\">yes</span>\n<span class=\"token builtin class-name\">read</span> only <span class=\"token operator\">=</span> no\nhosts allow <span class=\"token operator\">=</span> <span class=\"token number\">188.128</span>.110.170\nhosts deny <span class=\"token operator\">=</span> *</code></pre>\n<p>Después de cambiar la configuración, reiníciela. No uso autenticación de contraseña, así que comenté dos líneas (#).</p>\n<pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">sudo</span> systemctl restart rsyncd.service</code></pre>\n<p>Según mis pruebas, es mejor transferir datos sin comprimir (Sincronización).</p>\n<p>Ejemplo de directorio y carga de archivos.</p>\n<pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">rsync</span> -auvz -L -P ~/test.sfs rsync://187.187.55.18/dump\n\n<span class=\"token function\">rsync</span> -auvz -L -P ~/dir/* rsync://187.187.55.18/dump</code></pre>\n<p>Recepción.</p>\n<pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">rsync</span> -auvz -L -P rsync://187.187.55.18/dump ~/.dump/</code></pre>\n<p>Ssh.</p>\n<pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">rsync</span> -auvz -L -P -e <span class=\"token string\">\"ssh -p 2222\"</span> name@187.187.55.18:/path/to/copy /local/path\n\n<span class=\"token function\">rsync</span> -auvz -L -P -e <span class=\"token string\">\"ssh -p 2222\"</span> /local/path name@187.187.55.18:/path/to/copy</code></pre>\n","sidebar":"wiki","next":"","prev":"/wiki/backup/squashfs/","headings":[{"depth":2,"value":"Trabajando con Netcat, ssh, rsync","anchor":"#trabajando-con-netcat-ssh-rsync"},{"depth":2,"value":"Un ejemplo de cómo obtener un túnel ssh","anchor":"#un-ejemplo-de-cómo-obtener-un-túnel-ssh"},{"depth":2,"value":"SSH ","anchor":"#ssh-scp"},{"depth":2,"value":"Sincronización Rsync","anchor":"#sincronización-rsync"}]},"allMarkdownPage":{"edges":[{"node":{"path":"/wiki/changelog/bspwm-1-0/","title":"Bspwm 1.0B"}},{"node":{"path":"/wiki/packages/iwd/","title":"Iwd wifi"}},{"node":{"path":"/wiki/wm/bspwm/","title":"Killer-OS Bspwm"}},{"node":{"path":"/wiki/other/screencast/","title":"Screencast"}},{"node":{"path":"/wiki/packages/other-pkg/","title":"Añadir. programas"}},{"node":{"path":"/wiki/other/notes/","title":"Notas"}},{"node":{"path":"/wiki/other/grub-uefi/","title":"Grub UEFI"}},{"node":{"path":"/wiki/other/gnupg/","title":"Gnupg"}},{"node":{"path":"/wiki/other/git-start/","title":"Git Start"}},{"node":{"path":"/wiki/changelog/","title":"Changelog"}},{"node":{"path":"/wiki/config/videocfg/","title":"Видео драйвера"}},{"node":{"path":"/wiki/whois/","title":"Brevemente sobre Killer-OS Linux"}},{"node":{"path":"/wiki/config/trouble/","title":"Решение проблем"}},{"node":{"path":"/wiki/backup/netcat/","title":"Netcat, ssh, rsync"}},{"node":{"path":"/wiki/config/ssh/","title":"Настройка ssh"}},{"node":{"path":"/wiki/config/recomend/","title":"Рекомендации"}},{"node":{"path":"/wiki/config/autologin/","title":"Автологин"}},{"node":{"path":"/wiki/btrfs/btrfs-part2/","title":"Btrfs Continuar"}},{"node":{"path":"/wiki/btrfs/btrfs-part1/","title":"Instalación de btrfs"}},{"node":{"path":"/wiki/backup/timeshift-rsync/","title":"Timeshift, rsync"}},{"node":{"path":"/wiki/backup/squashfs/","title":"Squashfs"}},{"node":{"path":"/wiki/","title":"Killer-OS Linux Wiki"}}]}},"context":{}}