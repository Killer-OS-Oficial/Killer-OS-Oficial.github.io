{"hash":"bdd93fc59b94185fbbcb659806e55b3f9296e82c","data":{"markdownPage":{"id":"e38deb84d481f0a4d28f881f87c6fc3f","title":"Btrfs Continuar","description":"Cómo restaurar Arch Linux a btrfs.","date":null,"date_up":"13.08.2020","path":"/wiki/btrfs/btrfs-part2/","timeToRead":6,"content":"<h1 id=\"transferencia-btrfs-recuperación\"><a href=\"#transferencia-btrfs-recuperaci%C3%B3n\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>Transferencia Btrfs, recuperación</h1>\n<h2 id=\"transferir-a-la-partición-btrfs-rsync\"><a href=\"#transferir-a-la-partici%C3%B3n-btrfs-rsync\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>Transferir a la partición btrfs, rsync</h2>\n<pre class=\"language-bash\"><code class=\"language-bash\">pacman -S <span class=\"token function\">rsync</span> btrfs-progs arch-install-scripts</code></pre>\n<p><code>lsblk</code> - resalte todas las secciones para decidir qué montar.</p>\n<p>Si es necesario, particione el disco, -z dice que ponga a cero la tabla de particiones.</p>\n<pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">cfdisk</span> -z /dev/sda</code></pre>\n<p>Montamos.</p>\n<pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">mount</span> /dev/sda6 /mnt</code></pre>\n<p>Creemos tres subvolúmenes raíz, un directorio de inicio de usuario y un subvolumen de almacenamiento.</p>\n<pre class=\"language-bash\"><code class=\"language-bash\">btrfs subvolume create /mnt/@_root\nbtrfs subvolume create /mnt/@_home\nbtrfs subvolume create /mnt/@_snapshots\n\nbtrfs subvolume list /mnt</code></pre>\n<p>Para transferir, monte el sistema de respaldo y transfiéralo.</p>\n<pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">mkdir</span> /mnt/dump\n<span class=\"token function\">mount</span> /dev/sdb1 /mnt/dump</code></pre>\n<pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">rsync</span> -avAXHP --delete --delete-excluded --exclude<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span><span class=\"token string\">\"/dev/*\"</span>,<span class=\"token string\">\"/proc/*\"</span>,<span class=\"token string\">\"/sys/*\"</span>,<span class=\"token string\">\"/tmp/*\"</span>,<span class=\"token string\">\"/run/*\"</span>,<span class=\"token string\">\"/mnt/*\"</span>,<span class=\"token string\">\"/media/*\"</span>,<span class=\"token string\">\"/lost+found\"</span>,<span class=\"token string\">\"/var/lib/pacman/sync/*\"</span>,<span class=\"token string\">\"/var/cache/*\"</span>,<span class=\"token string\">\"/var/tmp/*\"</span>,<span class=\"token string\">\"/boot/*\"</span>,<span class=\"token string\">\"/home/*\"</span><span class=\"token punctuation\">}</span> /mnt/dump/@/* /mnt/@_root/</code></pre>\n<pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">rsync</span> -avAXHP --delete --delete-excluded --exclude<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span><span class=\"token string\">\"/dev/*\"</span>,<span class=\"token string\">\"/proc/*\"</span>,<span class=\"token string\">\"/sys/*\"</span>,<span class=\"token string\">\"/tmp/*\"</span>,<span class=\"token string\">\"/run/*\"</span>,<span class=\"token string\">\"/mnt/*\"</span>,<span class=\"token string\">\"/media/*\"</span>,<span class=\"token string\">\"/lost+found\"</span>,<span class=\"token string\">\"/var/lib/pacman/sync/*\"</span>,<span class=\"token string\">\"/var/cache/*\"</span>,<span class=\"token string\">\"/var/tmp/*\"</span>,<span class=\"token string\">\"/boot/*\"</span>,<span class=\"token string\">\"/home/*\"</span><span class=\"token punctuation\">}</span> /mnt/dump/@home/* /mnt/@_home/</code></pre>\n<p>Y desmonte la raíz FS.</p>\n<pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">umount</span> /mnt\n<span class=\"token function\">rm</span> -rf /mnt/dump</code></pre>\n<p>Para montar un subvolumen como una partición de disco normal, el comando de montaje debe especificar la opción subvol=PATH. PATH: ruta relativa a la raíz FS. Monte la raíz. Compresión zstd o lzo.</p>\n<pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">mount</span> -o <span class=\"token assign-left variable\">subvol</span><span class=\"token operator\">=</span>@,compress<span class=\"token operator\">=</span>zstd /dev/sda6 /mnt</code></pre>\n<p>¿Cuáles son las opciones recomendadas para instalar en una tarjeta SD o una unidad SSD lenta? en <code>/etc/fstab</code> . <a href=\"https://wiki.debian.org/Btrfs\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">https://wiki.debian.org/Btrfs</a>.</p>\n<pre class=\"language-bash\"><code class=\"language-bash\">/dev/sdaX / btrfs x-systemd.device-timeout<span class=\"token operator\">=</span><span class=\"token number\">0</span>,noatime,compress<span class=\"token operator\">=</span>lzo,commit<span class=\"token operator\">=</span><span class=\"token number\">0</span>,ssd_spread,autodefrag <span class=\"token number\">0</span> <span class=\"token number\">0</span>\n\n<span class=\"token assign-left variable\">UUID</span><span class=\"token operator\">=</span><span class=\"token operator\">&lt;</span>the_device_uuid<span class=\"token operator\">></span> /mount/point/ btrfs noauto,compress<span class=\"token operator\">=</span>lzo,noatime,autodefrag <span class=\"token number\">0</span> <span class=\"token number\">0</span></code></pre>\n<p>Creamos un directorio y montamos nuestro directorio de usuario futuro en él, si la partición de arranque está separada, debe montarlo en <code>/mnt/boot</code>.</p>\n<p>Si es necesario<code>mkdir /mnt/home</code>.</p>\n<pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">mount</span> -o <span class=\"token assign-left variable\">subvol</span><span class=\"token operator\">=</span>@home,compress<span class=\"token operator\">=</span>zstd /dev/sda6 /mnt/home</code></pre>\n<p>Si es necesario <code>mkdir /mnt/snapshots</code>.</p>\n<pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">mount</span> -o <span class=\"token assign-left variable\">subvol</span><span class=\"token operator\">=</span>@snapshots,compress<span class=\"token operator\">=</span>zstd /dev/sda6 /mnt/snapshots\n\n<span class=\"token function\">mount</span> -t proc none /mnt/proc\n<span class=\"token function\">mount</span> -t sysfs none /mnt/sys\n<span class=\"token function\">mount</span> -o <span class=\"token builtin class-name\">bind</span> /dev /mnt/dev\n\n<span class=\"token function\">cp</span> -L /etc/resolv.conf /mnt/etc\n\n<span class=\"token function\">swapon</span> /dev/sda3</code></pre>\n<p>A partir del kernel 5.0, puede crear un archivo de intercambio, el archivo de intercambio debe estar ubicado completamente en un dispositivo, creado con COW deshabilitado y compresión.</p>\n<pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">touch</span> /swap             <span class=\"token comment\"># crear un archivo /swap</span>\n<span class=\"token function\">chmod</span> go-r /swap        <span class=\"token comment\"># el intercambio debe ser 600</span>\nchattr +C /swap         <span class=\"token comment\"># apagar COW, la compresión también se apaga</span>\nfallocate /swap -l4g    <span class=\"token comment\"># Archivo 4Gb</span>\n<span class=\"token function\">mkswap</span> /swap\n<span class=\"token function\">swapon</span> /swap</code></pre>\n<p>Ahora necesitamos inicializar el sistema. Edite FSTAB o ejecute genfstab.</p>\n<pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">rm</span> /mnt/etc/fstab\ngenfstab -pU /mnt <span class=\"token operator\">></span> /mnt/etc/fstab</code></pre>\n<p>Vayamos a nuestro nuevo sistema.</p>\n<pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">chroot</span> /mnt /bin/bash</code></pre>\n<p>Generando initramfs con mkinicpio.</p>\n<pre class=\"language-bash\"><code class=\"language-bash\">mkinitcpio -p linux</code></pre>\n<p>Instale el cargador de arranque GRUB2 y configúrelo.</p>\n<pre class=\"language-bash\"><code class=\"language-bash\">grub-install /dev/sdХ\n<span class=\"token function\">grub-mkconfig</span> -o /boot/grub/grub.cfg</code></pre>\n<p><code>exit</code> o \"Ctrl + D\" para salir de chroot.</p>\n<p>Ahora necesitas desmontar todo.</p>\n<pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">umount</span> /mnt/home\n<span class=\"token function\">umount</span> /mnt/snapshots\n<span class=\"token function\">umount</span> /mnt\nreeboot</code></pre>\n<hr>\n<h2 id=\"instantánea-a-otra-particióndisco\"><a href=\"#instant%C3%A1nea-a-otra-partici%C3%B3ndisco\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>Instantánea a otra partición/disco</h2>\n<ul>\n<li><a href=\"https://btrfs.wiki.kernel.org/index.php/Incremental_Backup\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Incremental_Backup</a></li>\n<li><a href=\"https://github.com/masc3d/btrfs-sxbackup\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">btrfs-sxbackup</a></li>\n<li><a href=\"https://github.com/YHNdnzj/btrfs-snapshot\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">btrfs-snapshot</a></li>\n</ul>\n<p>Montamos la sección principal.</p>\n<pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">mkdir</span> /mnt/arch\n<span class=\"token function\">mount</span> /dev/sda6 /mnt/arch</code></pre>\n<p>Monte la partición/disco para volcar la instantánea.</p>\n<pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">mkdir</span> /mnt/dump\n<span class=\"token function\">mount</span> /dev/sda8 /mnt/dump</code></pre>\n<p>Es necesario crear instantáneas, solo lectura, requiere <code>enviar</code>. Para enviar a otros nodos.</p>\n<blockquote>\n<p>Volcamos todo, desde la caché hasta el disco <code>sync</code>, IMPORTANTE.</p>\n</blockquote>\n<pre class=\"language-bash\"><code class=\"language-bash\">btrfs subvolume snapshot -r /mnt/arch/@ /mnt/arch/@_BACKUP\n<span class=\"token function\">sync</span>\nbtrfs subvolume snapshot -r /mnt/arch/@home /mnt/arch/@home_BACKUP\n<span class=\"token function\">sync</span></code></pre>\n<p>Transferimos instantáneas. Puede enviar a archivo<code>btrfs send /mnt/arch/@_BACKUP -f /dump.sn</code>, recibir de archivo<code>btrfs receive /mnt/dump/ -f /dump.sn</code>.</p>\n<pre class=\"language-bash\"><code class=\"language-bash\">btrfs send /mnt/arch/@_BACKUP <span class=\"token operator\">|</span> btrfs receive /mnt/dump/\nbtrfs send /mnt/arch/@home_BACKUP <span class=\"token operator\">|</span> btrfs receive /mnt/dump/</code></pre>\n<p>Instantáneas incrementales de solo lectura.</p>\n<pre class=\"language-bash\"><code class=\"language-bash\">btrfs subvolume snapshot -r /mnt/arch/@ /mnt/arch/@_BACKUP_new\n<span class=\"token function\">sync</span>\nbtrfs subvolume snapshot -r /mnt/arch/@home /mnt/arch/@home_BACKUP_new\n<span class=\"token function\">sync</span></code></pre>\n<p>Crea una diferencia entre las imágenes.</p>\n<pre class=\"language-bash\"><code class=\"language-bash\">btrfs send -p /mnt/arch/@_BACKUP /mnt/arch/@_BACKUP_new <span class=\"token operator\">|</span> btrfs receive /mnt/dump/\nbtrfs send -p /mnt/arch/@home_BACKUP /mnt/arch/@home_BACKUP_new <span class=\"token operator\">|</span> btrfs receive /mnt/dump/</code></pre>\n<p>Echemos un vistazo a la lista.</p>\n<pre class=\"language-bash\"><code class=\"language-bash\">btrfs subvolume list /mnt/dump</code></pre>\n<h3 id=\"envío-de-ssh\"><a href=\"#env%C3%ADo-de-ssh\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>Envío de SSH</h3>\n<p>Localmente: generar claves, crear <code>~/.ssh/config</code>.</p>\n<pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token comment\"># generación de un par de claves, públicas (enviar al servidor)</span>\n<span class=\"token comment\"># id_rsa.pub</span>\nssh-keygen -t rsa -b <span class=\"token number\">4096</span> -C <span class=\"token string\">\"lol@gmail.com\"</span>\n\n<span class=\"token comment\"># nano ~/.ssh/config</span>\nHost office\n    HostName <span class=\"token number\">192.168</span>.100.51\n    Port <span class=\"token number\">22</span>\n    User <span class=\"token builtin class-name\">test</span></code></pre>\n<pre class=\"language-bash\"><code class=\"language-bash\">PasswordAuthentication <span class=\"token function\">yes</span>                 <span class=\"token comment\"># en el servidor /etc/ssh/sshd_config</span>\nsystemctl restart sshd\nssh-copy-id -i ~/.ssh/id_rsa.pub office    <span class=\"token comment\"># enviando la clave al servidor</span>\n<span class=\"token comment\"># en el servidor /etc/ssh/sshd_config</span>\nPermitRootLogin no\nPasswordAuthentication no                  <span class=\"token comment\"># deshabilitar el acceso con contraseña, todos.</span>\nPubkeyAuthentication <span class=\"token function\">yes</span>\nAuthorizedKeysFile .ssh/authorized_keys\nsystemctl restart sshd\nsystemctl <span class=\"token builtin class-name\">enable</span> sshd\n\nbtrfs send /mnt/arch/@_BACKUP <span class=\"token operator\">|</span> <span class=\"token function\">ssh</span> office <span class=\"token string\">\"btrfs receive /mnt/backups\"</span>\n<span class=\"token comment\"># o</span>\nbtrfs send /mnt/arch/@_BACKUP <span class=\"token operator\">|</span> <span class=\"token function\">ssh</span> -p <span class=\"token number\">22</span> test@192.168.100.51 <span class=\"token string\">\"btrfs receive /mnt/backups\"</span></code></pre>\n<p>Пример скрипта - инкрементальный, взято с (ubuntu.ru/wiki).</p>\n<pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token shebang important\">#!/bin/bash</span>\n<span class=\"token comment\"># puntos de montaje</span>\n<span class=\"token assign-left variable\">src</span><span class=\"token operator\">=</span><span class=\"token variable\"><span class=\"token variable\">$(</span>mktemp -d <span class=\"token string\">\"<span class=\"token variable\">${TMPDIR<span class=\"token operator\">:-</span><span class=\"token operator\">/</span>tmp<span class=\"token operator\">/</span>}</span><span class=\"token variable\"><span class=\"token variable\">$(</span><span class=\"token function\">basename</span> <span class=\"token number\">0</span><span class=\"token variable\">)</span></span>.XXXXXXXXXXXX\"</span><span class=\"token variable\">)</span></span>\n<span class=\"token assign-left variable\">dst</span><span class=\"token operator\">=</span><span class=\"token variable\"><span class=\"token variable\">$(</span>mktemp -d <span class=\"token string\">\"<span class=\"token variable\">${TMPDIR<span class=\"token operator\">:-</span><span class=\"token operator\">/</span>tmp<span class=\"token operator\">/</span>}</span><span class=\"token variable\"><span class=\"token variable\">$(</span><span class=\"token function\">basename</span> <span class=\"token number\">0</span><span class=\"token variable\">)</span></span>.XXXXXXXXXXXX\"</span><span class=\"token variable\">)</span></span>\n<span class=\"token comment\"># montamos</span>\n<span class=\"token function\">mount</span> /dev/sda2 <span class=\"token variable\">$src</span>\n<span class=\"token function\">mount</span> /dev/sdb2 <span class=\"token variable\">$dst</span>\n<span class=\"token keyword\">if</span> <span class=\"token punctuation\">[</span> -e <span class=\"token variable\">$src</span>/root_BCKP <span class=\"token punctuation\">]</span>\n<span class=\"token keyword\">then</span> <span class=\"token comment\"># primer lanzamiento de copia de seguridad completa</span>\n  <span class=\"token comment\"># Crea una instantánea de solo lectura</span>\n  btrfs subvolume snapshot -r <span class=\"token variable\">$src</span>/@ <span class=\"token variable\">$src</span>/root_BCKP\n  <span class=\"token function\">sync</span>\n  <span class=\"token comment\"># Continuar</span>\n  btrfs send <span class=\"token variable\">$src</span>/root_BCKP <span class=\"token operator\">|</span> btrfs receive <span class=\"token variable\">$dst</span>/\n<span class=\"token keyword\">else</span> <span class=\"token comment\"># reiniciar, incremental</span>\n  <span class=\"token comment\"># Rebautizar</span>\n  <span class=\"token function\">mv</span> <span class=\"token variable\">$src</span>/root_BCKP <span class=\"token variable\">$src</span>/root_BCKP_prev\n  <span class=\"token function\">mv</span> <span class=\"token variable\">$dst</span>/root_BCKP <span class=\"token variable\">$dst</span>/root_BCKP_prev\n  <span class=\"token comment\"># Crea la corriente</span>\n  btrfs subvolume snapshot -r <span class=\"token variable\">$src</span>/@ <span class=\"token variable\">$src</span>/root_BACKUP\n  <span class=\"token function\">sync</span>\n  <span class=\"token comment\"># respaldo incremental</span>\n  btrfs send -p <span class=\"token variable\">$src</span>/root_BCKP_prev <span class=\"token variable\">$src</span>/root_BACKUP <span class=\"token operator\">|</span> btrfs receive <span class=\"token variable\">$dst</span>/\n<span class=\"token keyword\">fi</span>\n<span class=\"token comment\"># en $dst/root_BACKUP copia de la raíz.</span>\n<span class=\"token function\">umount</span> <span class=\"token variable\">$src</span>\n<span class=\"token function\">umount</span> <span class=\"token variable\">$dst</span>\n<span class=\"token comment\"># Eliminar puntos de montaje</span>\n<span class=\"token function\">rmdir</span> <span class=\"token variable\">$src</span>\n<span class=\"token function\">rmdir</span> <span class=\"token variable\">$dst</span></code></pre>\n<blockquote>\n<p>Todo funciona al revés también.</p>\n</blockquote>\n<p>Eliminar o cambiar el nombre <code>mv</code>.</p>\n<pre class=\"language-bash\"><code class=\"language-bash\">btrfs subvolume delete /mnt/dump/@_BACKUP\nbtrfs subvolume delete /mnt/dump/@home_BACKUP</code></pre>\n<p>Cambie el nombre de las nuevas instantáneas.</p>\n<pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">mv</span> /mnt/dump/@_BACKUP_new /mnt/dump/@\n<span class=\"token function\">mv</span> /mnt/dump/@home_BACKUP_new /mnt/dump/@home</code></pre>\n<blockquote>\n<p>Propiedades. Ahora están en ro - solo lectura (solo lectura), cambian a rw - lectura-escritura (lectura-escritura). Los valores cambian así: <code>ro true</code>,<code>ro false</code>.</p>\n</blockquote>\n<pre class=\"language-bash\"><code class=\"language-bash\">btrfs property get /mnt/dump/@        <span class=\"token comment\"># ver propiedades</span>\n\nbtrfs property <span class=\"token builtin class-name\">set</span> /mnt/dump/@ ro <span class=\"token boolean\">false</span>\nbtrfs property <span class=\"token builtin class-name\">set</span> /mnt/dump/@home ro <span class=\"token boolean\">false</span>\n\nbtrfs subvolume show /mnt/dump/@      <span class=\"token comment\"># información</span></code></pre>\n<p>Eliminar si es necesario.</p>\n<pre class=\"language-bash\"><code class=\"language-bash\">btrfs subvolume delete /mnt/arch/@_BACKUP\nbtrfs subvolume delete /mnt/arch/@home_BACKUP</code></pre>\n<p>Desmontar.</p>\n<pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">umount</span> /mnt/arch\n<span class=\"token function\">umount</span> /mnt/dump\n\n<span class=\"token function\">rmdir</span> /mnt/<span class=\"token punctuation\">{</span>arch,dump<span class=\"token punctuation\">}</span></code></pre>\n<blockquote>\n<p>La recuperación, como arriba, se carga desde live-usb o desde otro sistema. Monte la partición para recuperación, la dañada y la partición con copia de seguridad, restaure instantáneas.</p>\n</blockquote>\n<p>Monte el sistema de archivos para reconstruir fstab e inicializar.</p>\n<pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">mount</span> -o <span class=\"token assign-left variable\">subvol</span><span class=\"token operator\">=</span>@,compress<span class=\"token operator\">=</span>zstd /dev/sda8 /mnt\n<span class=\"token function\">ls</span> /mnt\n<span class=\"token function\">mount</span> -o <span class=\"token assign-left variable\">subvol</span><span class=\"token operator\">=</span>@home,compress<span class=\"token operator\">=</span>zstd /dev/sda8 /mnt/home</code></pre>\n<p>Si la partición de arranque está separada, entonces debe montarla en /mnt/boot y en todos los demás subvolúmenes.</p>\n<pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">mount</span> /dev/sda2 /mnt/boot\n\n<span class=\"token function\">mount</span> -t proc none /mnt/proc\n<span class=\"token function\">mount</span> -t sysfs none /mnt/sys\n<span class=\"token function\">mount</span> -o <span class=\"token builtin class-name\">bind</span> /dev /mnt/dev\n\n<span class=\"token function\">cp</span> -L /etc/resolv.conf /mnt/etc\n\n<span class=\"token function\">swapon</span> /dev/sda3</code></pre>\n<p>A partir del kernel 5.0, puede crear un archivo de intercambio, el archivo de intercambio debe estar ubicado completamente en un dispositivo, creado con COW deshabilitado y compresión.</p>\n<pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">touch</span> /swap             <span class=\"token comment\"># crear un archivo vacío/swap</span>\n<span class=\"token function\">chmod</span> go-r /swap        <span class=\"token comment\"># el intercambio debe ser 600</span>\nchattr +C /swap         <span class=\"token comment\"># apagar COW, la compresión también se apaga</span>\nfallocate /swap -l4g    <span class=\"token comment\"># Archivo 4Gb</span>\n<span class=\"token function\">mkswap</span> /swap\n<span class=\"token function\">swapon</span> /swap</code></pre>\n<p>Edite FSTAB o ejecute genfstab.</p>\n<pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">rm</span> /mnt/etc/fstab\ngenfstab -pU /mnt <span class=\"token operator\">></span> /mnt/etc/fstab\n\n<span class=\"token function\">nano</span> /mnt/etc/fstab</code></pre>\n<p>Vayamos a nuestro nuevo sistema.</p>\n<pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">chroot</span> /mnt</code></pre>\n<p>O zsh.</p>\n<pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">chroot</span> /mnt /bin/zsh</code></pre>\n<p>Regenerado.</p>\n<pre class=\"language-bash\"><code class=\"language-bash\">mkinitcpio -p linux</code></pre>\n<p>Instale el cargador de arranque GRUB2 y configúrelo.</p>\n<pre class=\"language-bash\"><code class=\"language-bash\">grub-install /dev/sdХ\n<span class=\"token function\">grub-mkconfig</span> -o /boot/grub/grub.cfg</code></pre>\n<p>Inicializamos las claves y las actualizamos si es necesario.</p>\n<pre class=\"language-bash\"><code class=\"language-bash\">pacman-key --init <span class=\"token operator\">&amp;&amp;</span> pacman-key --populate <span class=\"token operator\">&amp;&amp;</span> pacman-key --refresh-keys <span class=\"token operator\">&amp;&amp;</span> pacman -Syy</code></pre>\n<p><code>exit</code> o \"Ctrl + D\" para salir de chroot.</p>\n<p>Ahora necesitas desmontar todo.</p>\n<pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">umount</span> -R /mnt\nreeboot</code></pre>\n","sidebar":"wiki","next":"","prev":"/wiki/btrfs/btrfs-part1/","headings":[{"depth":1,"value":"Transferencia Btrfs, recuperación","anchor":"#transferencia-btrfs-recuperación"},{"depth":2,"value":"Transferir a la partición btrfs, rsync","anchor":"#transferir-a-la-partición-btrfs-rsync"},{"depth":2,"value":"Instantánea a otra partición/disco","anchor":"#instantánea-a-otra-particióndisco"},{"depth":3,"value":"Envío de SSH","anchor":"#envío-de-ssh"}]},"allMarkdownPage":{"edges":[{"node":{"path":"/wiki/changelog/bspwm-1-0/","title":"Bspwm 1.0B"}},{"node":{"path":"/wiki/wm/bspwm/","title":"Killer-OS Bspwm"}},{"node":{"path":"/wiki/packages/other-pkg/","title":"Añadir. programas"}},{"node":{"path":"/wiki/packages/iwd/","title":"Iwd wifi"}},{"node":{"path":"/wiki/other/screencast/","title":"Screencast"}},{"node":{"path":"/wiki/other/notes/","title":"Notas"}},{"node":{"path":"/wiki/other/grub-uefi/","title":"Grub UEFI"}},{"node":{"path":"/wiki/other/gnupg/","title":"Gnupg"}},{"node":{"path":"/wiki/other/git-start/","title":"Git Start"}},{"node":{"path":"/wiki/config/videocfg/","title":"Видео драйвера"}},{"node":{"path":"/wiki/config/trouble/","title":"Решение проблем"}},{"node":{"path":"/wiki/config/ssh/","title":"Настройка ssh"}},{"node":{"path":"/wiki/config/recomend/","title":"Рекомендации"}},{"node":{"path":"/wiki/config/autologin/","title":"Автологин"}},{"node":{"path":"/wiki/changelog/","title":"Changelog"}},{"node":{"path":"/wiki/btrfs/btrfs-part2/","title":"Btrfs Continuar"}},{"node":{"path":"/wiki/btrfs/btrfs-part1/","title":"Instalación de btrfs"}},{"node":{"path":"/wiki/backup/timeshift-rsync/","title":"Timeshift, rsync"}},{"node":{"path":"/wiki/backup/squashfs/","title":"Squashfs"}},{"node":{"path":"/wiki/backup/netcat/","title":"Netcat, ssh, rsync"}},{"node":{"path":"/wiki/whois/","title":"Brevemente sobre Killer-OS Linux"}},{"node":{"path":"/wiki/","title":"Killer-OS Linux Wiki"}}]}},"context":{}}